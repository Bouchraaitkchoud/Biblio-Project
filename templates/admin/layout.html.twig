{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/style1.css') }}?v={{ "now"|date('YmdHis') }}">
    <link rel="stylesheet" href="{{ asset('css/admin.css') }}?v={{ "now"|date('YmdHis') }}">
    <style>
        .admin-main-content {
            margin: 0 auto;
            max-width: 900px;
            padding: 2.5rem 2rem 2rem 2rem;
            min-height: 100vh;
            background: #fdfaf5;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="admin-main-content">
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endfor %}
            {% block admin_content %}{% endblock %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Force immediate CSS reloading on every page transition
        document.addEventListener('DOMContentLoaded', function() {
            // Reload stylesheets
            var links = document.getElementsByTagName('link');
            for (var i = 0; i < links.length; i++) {
                if (links[i].rel === 'stylesheet') {
                    var href = links[i].href;
                    links[i].href = href + (href.indexOf('?') >= 0 ? '&' : '?') + 'forceReload=' + new Date().getTime();
                }
            }
            
            // Force style recalculation
            setTimeout(function() {
                document.querySelectorAll('.admin-nav, .admin-table, .actions').forEach(function(el) {
                    el.style.display = 'none';
                    el.offsetHeight; // Force reflow
                    el.style.display = '';
                });
                
                // Make sure action buttons are properly styled
                document.querySelectorAll('.actions .btn').forEach(function(btn) {
                    btn.style.display = 'inline-flex !important';
                    btn.style.alignItems = 'center !important';
                    btn.style.justifyContent = 'center !important';
                });
            }, 50);
        });
        
        // Prevent caching and ensure full page reload when navigating
        window.onpageshow = function(event) {
            if (event.persisted) {
                window.location.reload();
            }
        };
        
        // Add cache-busting parameter to certain links
        document.addEventListener('DOMContentLoaded', function() {
            // For special navigation that requires full page reload (like admin to main site)
            document.querySelectorAll('a[href*="app_domains"]').forEach(function(link) {
                if (!link.getAttribute('onclick')) {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        let url = this.href;
                        url += (url.includes('?') ? '&' : '?') + '_=' + new Date().getTime();
                        window.location.href = url;
                    });
                }
            });
        });
    </script>
{% endblock %} 