{% extends 'base.html.twig' %}

{% block title %}Disciplines{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        body {
            background: linear-gradient(135deg, #fdfaf5 0%, #f8f5f0 100%) !important;
            font-family: 'Georgia', serif;
            color: #4e4a45;
            min-height: 100vh;
        }

        .page-header {
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 2rem 0;
            color: #1a2e4f;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .disciplines-section {
            margin-top: 4rem;
            padding: 0 2rem;
        }

        .disciplines-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 1200px) {
            .disciplines-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .disciplines-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .disciplines-grid {
                grid-template-columns: 1fr;
            }
        }

        .discipline-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #b2903e;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 300px;
        }

        .discipline-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .discipline-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            margin: 0 auto 1.5rem auto;
            display: block;
            border: 3px solid #b2903e;
        }

        .discipline-icon {
            width: 80px;
            height: 80px;
            font-size: 2.5rem;
            color: #1a2e4f;
            background: linear-gradient(135deg, #b2903e, #d4af49);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem auto;
            box-shadow: 0 4px 15px rgba(178, 144, 62, 0.3);
        }

        .discipline-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a2e4f;
            margin-bottom: 1rem;
            text-align: center;
        }

        .discipline-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .discipline-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a2e4f;
            margin-bottom: 1rem;
        }

        .discipline-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .discipline-link {
            display: block;
            background: linear-gradient(135deg, #b2903e, #9b7e46);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            margin-top: auto;
        }

        .discipline-link:hover {
            background: linear-gradient(135deg, #9b7e46, #7d6435);
            color: white;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        
        .search-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin: 3rem auto;
            max-width: 800px;
            border-left: 5px solid #b2903e;
        }
        
        .search-input {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        
        .search-input:focus {
            border-color: #b2903e;
            box-shadow: 0 0 0 0.2rem rgba(178, 144, 62, 0.25);
            outline: none;
        }
        
        .btn-search {
            background: linear-gradient(135deg, #b2903e, #9b7e46);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-family: 'Georgia', serif;
            transition: all 0.3s ease;
        }
        
        .btn-search:hover {
            background: linear-gradient(135deg, #9b7e46, #7d6435);
            color: white;
        }
        
        .search-filters {
            margin-top: 1rem;
        }
        
        .search-filters {
            margin-top: 1rem;
        }
        
        .radio-group label {
            font-size: 0.9rem;
            color: #1a2e4f;
            font-weight: 500;
        }
        
        .radio-group label:hover {
            color: #b2903e;
        }
        
        .radio-group input[type="radio"]:checked + span {
            color: #b2903e;
            font-weight: bold;
        }
        
        .admin-banner {
            background: linear-gradient(135deg, #1a2e4f, #0f1a2e);
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 2rem;
            position: relative;
        }
        
        .admin-banner .container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .admin-banner i.fa-shield-alt {
            color: #b2903e;
            font-size: 1.2em;
        }
        
        .admin-back-link {
            background: linear-gradient(135deg, #b2903e, #d4af37);
            color: white !important;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        
        .admin-back-link:hover {
            background: linear-gradient(135deg, #d4af37, #b2903e);
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(178, 144, 62, 0.4);
        }
    </style>
{% endblock %}

{% block body %}
    {% block content %}
    
    {# NAVIGATION LECTEUR - FORCÉE ICI #}
    {% if app.user %}
    <div style="background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 1rem 2rem; margin-bottom: 2rem;">
        <div style="max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 2rem;">
                <span style="font-size: 1.5rem; font-weight: bold; color: #1a2e4f;">Bibliothèque UIASS</span>
            </div>
            <nav style="display: flex; gap: 1.5rem; align-items: center;">
                <span style="color: #1a2e4f; font-weight: 500;">
                    <i class="fas fa-user"></i>
                    Bonjour, <strong>{{ app.user.prenom|default(app.user.nom)|default('Utilisateur') }}</strong>
                </span>
                <a href="{{ path('view_cart') }}" style="color: #1a2e4f; text-decoration: none; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s; position: relative; font-weight: 500;">
                    <i class="fas fa-shopping-cart"></i> Panier
                    {% set cartCount = cart_count() %}
                    {% if cartCount > 0 %}
                        <span style="position: absolute; top: 0; right: 0; background: #dc3545; color: white; border-radius: 50%; padding: 0.2rem 0.5rem; font-size: 0.75rem; font-weight: bold;">{{ cartCount }}</span>
                    {% endif %}
                </a>
                <a href="{{ path('profile_index') }}" style="color: #1a2e4f; text-decoration: none; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s; font-weight: 500;">
                    <i class="fas fa-user-circle"></i> Mon Compte
                </a>
                <a href="{{ path('app_logout') }}" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; text-decoration: none; padding: 0.5rem 1.5rem; border-radius: 5px; transition: all 0.3s; font-weight: 600;">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </a>
            </nav>
        </div>
    </div>
    {% endif %}
    {# FIN NAVIGATION LECTEUR #}
    
    {% if show_admin_link is defined and show_admin_link %}
        <div class="admin-banner">
            <div class="container">
                <i class="fas fa-shield-alt"></i>
                Vous êtes connecté en tant qu'administrateur.
                <a href="{{ path('admin_dashboard') }}" class="admin-back-link">
                    <i class="fas fa-arrow-left"></i> Retour au panel admin
                </a>
            </div>
        </div>
    {% endif %}
    
    <div class="page-header">BIBLIOTHÈQUE UIASS</div>

    <!-- Section de recherche générale -->
    <div class="search-section">
        <h3 class="text-center mb-3" style="color: #1a2e4f; font-family: 'Merriweather', serif;">Recherche globale</h3>
        <form action="{{ path('search_results') }}" method="GET">
            <div class="input-group mb-3">
                <input type="text" class="form-control search-input" name="q" placeholder="Rechercher un livre, auteur, éditeur...">
                <button class="btn btn-search" type="submit">
                    <i class="fas fa-search"></i> Rechercher
                </button>
            </div>
            
            <div class="search-filters text-center">
                <small class="text-muted d-block mb-3">Recherche par :</small>
                <div class="radio-group" style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="all" style="margin: 0;">
                        <span><i class="fas fa-search"></i> Tout</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="title" checked style="margin: 0;">
                        <span><i class="fas fa-book"></i> Titre</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="author" style="margin: 0;">
                        <span><i class="fas fa-user"></i> Auteur</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="publisher" style="margin: 0;">
                        <span><i class="fas fa-building"></i> Éditeur</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="discipline" style="margin: 0;">
                        <span><i class="fas fa-tags"></i> Discipline</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="search_type" value="isbn" style="margin: 0;">
                        <span><i class="fas fa-barcode"></i> ISBN</span>
                    </label>
                </div>
            </div>
        </form>
    </div>

    <div class="disciplines-section">
        {% if disciplines is empty %}
            <div class="empty-state">
                <i class="fas fa-book-open"></i>
                <h3>Aucune discipline trouvée</h3>
                <p>Il n'y a aucune discipline disponible pour le moment.</p>
            </div>
        {% else %}
            <div class="disciplines-grid">
                {% for discipline in disciplines %}
                    <div class="discipline-card">
                        {% if discipline.image %}
                            <img src="{{ discipline.imageUrl }}" alt="{{ discipline.name }}" class="discipline-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        {% endif %}
                        <div class="discipline-icon" style="{% if discipline.image %}display: none;{% endif %}">
                            {% set disciplineName = discipline.name|lower %}
                            {% if 'informatique' in disciplineName or 'computer' in disciplineName %}
                                <i class="fas fa-laptop-code"></i>
                            {% elseif 'math' in disciplineName or 'mathématiques' in disciplineName %}
                                <i class="fas fa-calculator"></i>
                            {% elseif 'physique' in disciplineName or 'physics' in disciplineName %}
                                <i class="fas fa-atom"></i>
                            {% elseif 'chimie' in disciplineName or 'chemistry' in disciplineName %}
                                <i class="fas fa-flask"></i>
                            {% elseif 'biologie' in disciplineName or 'biology' in disciplineName %}
                                <i class="fas fa-dna"></i>
                            {% elseif 'histoire' in disciplineName or 'history' in disciplineName %}
                                <i class="fas fa-landmark"></i>
                            {% elseif 'géographie' in disciplineName or 'geography' in disciplineName %}
                                <i class="fas fa-globe-americas"></i>
                            {% elseif 'littérature' in disciplineName or 'literature' in disciplineName %}
                                <i class="fas fa-feather-alt"></i>
                            {% elseif 'philosophie' in disciplineName or 'philosophy' in disciplineName %}
                                <i class="fas fa-brain"></i>
                            {% elseif 'économie' in disciplineName or 'economy' in disciplineName %}
                                <i class="fas fa-chart-line"></i>
                            {% elseif 'psychologie' in disciplineName or 'psychology' in disciplineName %}
                                <i class="fas fa-head-side-virus"></i>
                            {% elseif 'sociologie' in disciplineName or 'sociology' in disciplineName %}
                                <i class="fas fa-users"></i>
                            {% elseif 'droit' in disciplineName or 'law' in disciplineName %}
                                <i class="fas fa-balance-scale"></i>
                            {% elseif 'médecine' in disciplineName or 'medicine' in disciplineName %}
                                <i class="fas fa-user-md"></i>
                            {% elseif 'art' in disciplineName %}
                                <i class="fas fa-palette"></i>
                            {% elseif 'musique' in disciplineName or 'music' in disciplineName %}
                                <i class="fas fa-music"></i>
                            {% elseif 'sport' in disciplineName %}
                                <i class="fas fa-running"></i>
                            {% elseif 'langue' in disciplineName or 'language' in disciplineName %}
                                <i class="fas fa-language"></i>
                            {% elseif 'ingénierie' in disciplineName or 'engineering' in disciplineName %}
                                <i class="fas fa-cogs"></i>
                            {% elseif 'management' in disciplineName or 'gestion' in disciplineName %}
                                <i class="fas fa-briefcase"></i>
                            {% else %}
                                <i class="fas fa-book"></i>
                            {% endif %}
                        </div>
                        <h3 class="discipline-name">{{ discipline.name }}</h3>
                        <a href="{{ path('discipline_books', {'id': discipline.id}) }}" class="discipline-link">
                            <i class="fas fa-book"></i> Voir les livres
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    {% endblock %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Simple - les boutons radio fonctionnent nativement !
        // Juste s'assurer qu'on a "title" sélectionné par défaut au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const titleRadio = document.querySelector('input[name="search_type"][value="title"]');
            if (titleRadio && !document.querySelector('input[name="search_type"]:checked')) {
                titleRadio.checked = true;
            }
        });
        
        // Réinitialiser sur navigation arrière
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                const titleRadio = document.querySelector('input[name="search_type"][value="title"]');
                if (titleRadio) {
                    // Décocher tous
                    document.querySelectorAll('input[name="search_type"]').forEach(r => r.checked = false);
                    // Sélectionner "title"
                    titleRadio.checked = true;
                }
            }
        });
    </script>
{% endblock %}