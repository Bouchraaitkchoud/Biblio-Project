# security:
#     password_hashers:
#         Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
#     providers:
#         users_in_memory:
#             memory:
#                  users:
#                     user1:
#                         password: password123
#                         roles: ROLE_USER
#         app_user_provider:
#             entity:
#                 class: App\Entity\User
#                 property: email
#     firewalls:
#         dev:
#             pattern: ^/(_(profiler|wdt)|css|images|js)/
#             security: false
#         main:
#             lazy: true
#             provider: app_user_provider
#             stateless: false
#             entry_point: form_login
#             http_basic:
#                 realm: Secured Area
#             # json_login:
#             #     check_path: /api/login
#             #     username_path: email
#             #     password_path: password
#             form_login:
#                 login_path: app_login
#                 check_path: app_login
#                 enable_csrf: true
#             logout:
#                 path: app_logout
#                 target: app_homepage
#             # Replace "anonymous: true" with the following:
#             security: true

#     access_control:
#         - { path: ^/admin, roles: ROLE_ADMIN }
#         - { path: ^/profile, roles: ROLE_USER }
#         - { path: ^/student, roles: ROLE_STUDENT }

# when@test:
#     security:
#         password_hashers:
#             Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
#                 algorithm: auto
#                 cost: 4
#                 time_cost: 3
#                 memory_cost: 10
security:
  enable_authenticator_manager: true
  password_hashers:
    App\Entity\User: "auto"
    App\Entity\Lecteur: 'plaintext'

  providers:
    admin_provider:
      entity:
        class: App\Entity\User
        property: login               # admin form: <input name="login">
    lecteur_provider:
      entity:
        class: App\Entity\Lecteur
        property: codeAdmission    # lecteur form: <input name="code_d_admission">

  role_hierarchy:
    ROLE_ADMIN:    [ROLE_USER]
    ROLE_LIMITED_ADMIN: [ROLE_USER]

  firewalls:
    dev:
      pattern: ^/(_(profiler|wdt)|css|images|js)/
      security: false

    admin:
      pattern: ^/admin
      provider: admin_provider
      form_login:
        success_handler: App\Security\LoginSuccessHandler
        login_path: app_admin_login
        check_path: app_admin_check
        username_parameter: login
        password_parameter: password
        enable_csrf: true
        default_target_path: admin_dashboard         # redirect admins here on success
        use_referer: false
      logout:
        path: /admin/logout
        target: app_admin_login

    main:
      provider: lecteur_provider
      form_login:
        success_handler: App\Security\LoginSuccessHandler
        login_path: app_login          # GET page
        check_path: app_login          # POST target (can be same route)
        username_parameter: codeAdmission   # <-- must match form input name
        password_parameter: password
        enable_csrf: true
        default_target_path: lecteur_dashboard       # redirect lecteurs here on success
        use_referer: true 
      logout:
        path: app_logout
        target: app_login

  access_control:
    - { path: ^/login, roles: PUBLIC_ACCESS }
    - { path: ^/admin/login, roles: PUBLIC_ACCESS }
    - { path: ^/admin/authors, roles: [ROLE_ADMIN, ROLE_GERER_AUTEURS] }
    - { path: ^/admin/users, roles: [ROLE_ADMIN, ROLE_GERER_UTILISATEURS] }
    - { path: ^/admin/books, roles: [ROLE_ADMIN, ROLE_GERER_LIVRES] }
    - { path: ^/admin/returns, roles: [ROLE_ADMIN, ROLE_GERER_RETOURS] }
    - { path: ^/admin/publishers, roles: [ROLE_ADMIN, ROLE_GERER_EDITEURS] }
    - { path: ^/admin/disciplines, roles: [ROLE_ADMIN, ROLE_GERER_DISCIPLINES] }
    - { path: ^/admin/orders, roles: [ROLE_ADMIN, ROLE_GERER_COMMANDES] }
    - { path: ^/, roles: ROLE_USER }
